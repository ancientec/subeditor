(()=>{var Qe=Object.create;var Y=Object.defineProperty;var Je=Object.getOwnPropertyDescriptor;var Ye=Object.getOwnPropertyNames;var Ze=Object.getPrototypeOf,$e=Object.prototype.hasOwnProperty;var et=n=>Y(n,"__esModule",{value:!0});var _=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var tt=(n,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Ye(e))!$e.call(n,i)&&i!=="default"&&Y(n,i,{get:()=>e[i],enumerable:!(t=Je(e,i))||t.enumerable});return n},P=n=>tt(et(Y(n!=null?Qe(Ze(n)):{},"default",n&&n.__esModule&&"default"in n?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n);var Ne=_((Xt,Ee)=>{var M=-1,A=1,L=0;function B(n,e,t,i){if(n===e)return n?[[L,n]]:[];if(t!=null){var r=lt(n,e,t);if(r)return r}var s=Z(n,e),o=n.substring(0,s);n=n.substring(s),e=e.substring(s),s=$(n,e);var l=n.substring(n.length-s);n=n.substring(0,n.length-s),e=e.substring(0,e.length-s);var a=it(n,e);return o&&a.unshift([L,o]),l&&a.push([L,l]),pe(a,i),a}function it(n,e){var t;if(!n)return[[A,e]];if(!e)return[[M,n]];var i=n.length>e.length?n:e,r=n.length>e.length?e:n,s=i.indexOf(r);if(s!==-1)return t=[[A,i.substring(0,s)],[L,r],[A,i.substring(s+r.length)]],n.length>e.length&&(t[0][0]=t[2][0]=M),t;if(r.length===1)return[[M,n],[A,e]];var o=st(n,e);if(o){var l=o[0],a=o[1],c=o[2],d=o[3],h=o[4],u=B(l,c),f=B(a,d);return u.concat([[L,h]],f)}return rt(n,e)}function rt(n,e){for(var t=n.length,i=e.length,r=Math.ceil((t+i)/2),s=r,o=2*r,l=new Array(o),a=new Array(o),c=0;c<o;c++)l[c]=-1,a[c]=-1;l[s+1]=0,a[s+1]=0;for(var d=t-i,h=d%2!=0,u=0,f=0,m=0,g=0,v=0;v<r;v++){for(var b=-v+u;b<=v-f;b+=2){var y=s+b,E;b===-v||b!==v&&l[y-1]<l[y+1]?E=l[y+1]:E=l[y-1]+1;for(var T=E-b;E<t&&T<i&&n.charAt(E)===e.charAt(T);)E++,T++;if(l[y]=E,E>t)f+=2;else if(T>i)u+=2;else if(h){var C=s+d-b;if(C>=0&&C<o&&a[C]!==-1){var S=t-a[C];if(E>=S)return ge(n,e,E,T)}}}for(var w=-v+m;w<=v-g;w+=2){var C=s+w,S;w===-v||w!==v&&a[C-1]<a[C+1]?S=a[C+1]:S=a[C-1]+1;for(var I=S-w;S<t&&I<i&&n.charAt(t-S-1)===e.charAt(i-I-1);)S++,I++;if(a[C]=S,S>t)g+=2;else if(I>i)m+=2;else if(!h){var y=s+d-w;if(y>=0&&y<o&&l[y]!==-1){var E=l[y],T=s+E-y;if(S=t-S,E>=S)return ge(n,e,E,T)}}}}return[[M,n],[A,e]]}function ge(n,e,t,i){var r=n.substring(0,t),s=e.substring(0,i),o=n.substring(t),l=e.substring(i),a=B(r,s),c=B(o,l);return a.concat(c)}function Z(n,e){if(!n||!e||n.charAt(0)!==e.charAt(0))return 0;for(var t=0,i=Math.min(n.length,e.length),r=i,s=0;t<r;)n.substring(s,r)==e.substring(s,r)?(t=r,s=t):i=r,r=Math.floor((i-t)/2+t);return me(n.charCodeAt(r-1))&&r--,r}function $(n,e){if(!n||!e||n.slice(-1)!==e.slice(-1))return 0;for(var t=0,i=Math.min(n.length,e.length),r=i,s=0;t<r;)n.substring(n.length-r,n.length-s)==e.substring(e.length-r,e.length-s)?(t=r,s=t):i=r,r=Math.floor((i-t)/2+t);return be(n.charCodeAt(n.length-r))&&r--,r}function st(n,e){var t=n.length>e.length?n:e,i=n.length>e.length?e:n;if(t.length<4||i.length*2<t.length)return null;function r(f,m,g){for(var v=f.substring(g,g+Math.floor(f.length/4)),b=-1,y="",E,T,C,S;(b=m.indexOf(v,b+1))!==-1;){var w=Z(f.substring(g),m.substring(b)),I=$(f.substring(0,g),m.substring(0,b));y.length<I+w&&(y=m.substring(b-I,b)+m.substring(b,b+w),E=f.substring(0,g-I),T=f.substring(g+w),C=m.substring(0,b-I),S=m.substring(b+w))}return y.length*2>=f.length?[E,T,C,S,y]:null}var s=r(t,i,Math.ceil(t.length/4)),o=r(t,i,Math.ceil(t.length/2)),l;if(!s&&!o)return null;o?s?l=s[4].length>o[4].length?s:o:l=o:l=s;var a,c,d,h;n.length>e.length?(a=l[0],c=l[1],d=l[2],h=l[3]):(d=l[0],h=l[1],a=l[2],c=l[3]);var u=l[4];return[a,c,d,h,u]}function pe(n,e){n.push([L,""]);for(var t=0,i=0,r=0,s="",o="",l;t<n.length;){if(t<n.length-1&&!n[t][1]){n.splice(t,1);continue}switch(n[t][0]){case A:r++,o+=n[t][1],t++;break;case M:i++,s+=n[t][1],t++;break;case L:var a=t-r-i-1;if(e){if(a>=0&&ye(n[a][1])){var c=n[a][1].slice(-1);if(n[a][1]=n[a][1].slice(0,-1),s=c+s,o=c+o,!n[a][1]){n.splice(a,1),t--;var d=a-1;n[d]&&n[d][0]===A&&(r++,o=n[d][1]+o,d--),n[d]&&n[d][0]===M&&(i++,s=n[d][1]+s,d--),a=d}}if(ve(n[t][1])){var c=n[t][1].charAt(0);n[t][1]=n[t][1].slice(1),s+=c,o+=c}}if(t<n.length-1&&!n[t][1]){n.splice(t,1);break}if(s.length>0||o.length>0){s.length>0&&o.length>0&&(l=Z(o,s),l!==0&&(a>=0?n[a][1]+=o.substring(0,l):(n.splice(0,0,[L,o.substring(0,l)]),t++),o=o.substring(l),s=s.substring(l)),l=$(o,s),l!==0&&(n[t][1]=o.substring(o.length-l)+n[t][1],o=o.substring(0,o.length-l),s=s.substring(0,s.length-l)));var h=r+i;s.length===0&&o.length===0?(n.splice(t-h,h),t=t-h):s.length===0?(n.splice(t-h,h,[A,o]),t=t-h+1):o.length===0?(n.splice(t-h,h,[M,s]),t=t-h+1):(n.splice(t-h,h,[M,s],[A,o]),t=t-h+2)}t!==0&&n[t-1][0]===L?(n[t-1][1]+=n[t][1],n.splice(t,1)):t++,r=0,i=0,s="",o="";break}}n[n.length-1][1]===""&&n.pop();var u=!1;for(t=1;t<n.length-1;)n[t-1][0]===L&&n[t+1][0]===L&&(n[t][1].substring(n[t][1].length-n[t-1][1].length)===n[t-1][1]?(n[t][1]=n[t-1][1]+n[t][1].substring(0,n[t][1].length-n[t-1][1].length),n[t+1][1]=n[t-1][1]+n[t+1][1],n.splice(t-1,1),u=!0):n[t][1].substring(0,n[t+1][1].length)==n[t+1][1]&&(n[t-1][1]+=n[t+1][1],n[t][1]=n[t][1].substring(n[t+1][1].length)+n[t+1][1],n.splice(t+1,1),u=!0)),t++;u&&pe(n,e)}function me(n){return n>=55296&&n<=56319}function be(n){return n>=56320&&n<=57343}function ve(n){return be(n.charCodeAt(0))}function ye(n){return me(n.charCodeAt(n.length-1))}function ot(n){for(var e=[],t=0;t<n.length;t++)n[t][1].length>0&&e.push(n[t]);return e}function ee(n,e,t,i){return ye(n)||ve(i)?null:ot([[L,n],[M,e],[A,t],[L,i]])}function lt(n,e,t){var i=typeof t=="number"?{index:t,length:0}:t.oldRange,r=typeof t=="number"?null:t.newRange,s=n.length,o=e.length;if(i.length===0&&(r===null||r.length===0)){var l=i.index,a=n.slice(0,l),c=n.slice(l),d=r?r.index:null;e:{var h=l+o-s;if(d!==null&&d!==h||h<0||h>o)break e;var u=e.slice(0,h),f=e.slice(h);if(f!==c)break e;var m=Math.min(l,h),g=a.slice(0,m),v=u.slice(0,m);if(g!==v)break e;var b=a.slice(m),y=u.slice(m);return ee(g,b,y,c)}e:{if(d!==null&&d!==l)break e;var E=l,u=e.slice(0,E),f=e.slice(E);if(u!==a)break e;var T=Math.min(s-E,o-E),C=c.slice(c.length-T),S=f.slice(f.length-T);if(C!==S)break e;var b=c.slice(0,c.length-T),y=f.slice(0,f.length-T);return ee(a,b,y,C)}}if(i.length>0&&r&&r.length===0){e:{var g=n.slice(0,i.index),C=n.slice(i.index+i.length),m=g.length,T=C.length;if(o<m+T)break e;var v=e.slice(0,m),S=e.slice(o-T);if(g!==v||C!==S)break e;var b=n.slice(m,s-T),y=e.slice(m,o-T);return ee(g,b,y,C)}}return null}function G(n,e,t){return B(n,e,t,!0)}G.INSERT=A;G.DELETE=M;G.EQUAL=L;Ee.exports=G});var Ce=_((Wt,Te)=>{"use strict";var at=Ne();Te.exports=function(n,e){for(var t=at(n,e),i=0;i<t.length;i++){var r=t[i];r[0]<1&&(r[1]=r[1].length)}return t}});var Le=_((zt,Se)=>{"use strict";Se.exports=function(n,e){for(var t="",i=0,r=0;r<e.length;r++){var s=e[r],o=s[0],l=s[1];o==-1?i+=l:o==0?t+=n.slice(i,i+=l):t+=l}return t}});var ie=_(ne=>{"use strict";ne.__esModule=!0;function we(n,e){for(var t=[];e!==n&&e.parentNode;)t.push(Array.from(e.parentNode.childNodes).indexOf(e)),e=e.parentNode;return t}function Ae(n){return te(n,!0)}function te(n,e){e===void 0&&(e=!1);var t=window.getSelection();if(!t||t.rangeCount===0)return e?{s:[],so:0,e:[],eo:0,d:"n"}:{startContainer:[],startOffset:0,endContainer:[],endOffset:0,direction:"none"};var i=t.getRangeAt(0);if(i.intersectsNode(n)){if(n.contains(i.startContainer)||i.setStart(n.childNodes.length===0?n:n.childNodes[0],0),!n.contains(i.endContainer))if(!n.childNodes.length)i.setEnd(n,0);else{var r=n.childNodes[n.childNodes.length-1];r.nodeType===3?i.setEnd(r,(r.textContent||"").length):i.setEnd(r,r.childNodes.length)}}else if(!n.contains(i.startContainer)||!n.contains(i.endContainer)){if(i.setStart(n.childNodes.length===0?n:n.childNodes[0],0),!n.childNodes.length)i.setEnd(n,0);else{var r=n.childNodes[n.childNodes.length-1];r.nodeType===3?i.setEnd(r,(r.textContent||"").length):i.setEnd(r,r.childNodes.length)}i.collapse(!1)}var s=we(n,i.startContainer),o=i.startOffset,l=i.startContainer===i.endContainer?s:we(n,i.endContainer),a=i.endOffset,c="none";return!t.isCollapsed&&t.anchorNode!==t.focusNode&&t.anchorNode&&t.focusNode&&(t.anchorNode.compareDocumentPosition(t.focusNode)&Node.DOCUMENT_POSITION_FOLLOWING?c="forward":t.anchorNode.compareDocumentPosition(t.focusNode)&Node.DOCUMENT_POSITION_PRECEDING&&(c="backward")),e?{s,so:o,e:l,eo:a,d:c.substring(0,1)}:{startContainer:s,startOffset:o,endContainer:l,endOffset:a,direction:c}}function Me(n,e){var t=window.getSelection();t==null||t.removeAllRanges();for(var i=e.hasOwnProperty("direction")?e:{startContainer:e.s,startOffset:e.so,endContainer:e.e,endOffset:e.eo,direction:e.d},r=n,s=i.startContainer.length-1;s>=0;s--)r.childNodes&&r.childNodes.length>i.startContainer[s]&&r.childNodes[i.startContainer[s]]&&(r=r.childNodes[i.startContainer[s]]);r.nodeType===Node.TEXT_NODE&&r.textContent.length<i.startOffset?i.startOffset=r.textContent.length:r.childNodes.length>=1&&r.childNodes.length<i.startOffset&&(i.startOffset=r.childNodes.length-1);for(var o=n,s=i.endContainer.length-1;s>=0;s--)o.childNodes&&o.childNodes.length>i.endContainer[s]&&o.childNodes[i.endContainer[s]]&&(o=o.childNodes[i.endContainer[s]]);o.nodeType===Node.TEXT_NODE&&o.textContent.length<i.endOffset?i.endOffset=o.textContent.length:o.childNodes.length>=1&&o.childNodes.length<i.endOffset&&(i.endOffset=o.childNodes.length-1);var l=document.createRange();i.direction==="backward"||i.direction==="b"?(l.setStart(o,i.endOffset),l.setEnd(o,i.endOffset),t==null||t.addRange(l),t==null||t.extend(r,i.startOffset),l=t==null?void 0:t.getRangeAt(0)):(l.setStart(r,i.startOffset),l.setEnd(o,i.endOffset),t==null||t.addRange(l))}typeof window!="undefined"&&(window.SelectionSerializer={save:te,saveSlim:Ae,restore:Me});ne.default={save:te,saveSlim:Ae,restore:Me}});var Fe=_(H=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0});var ct=typeof window!="undefined"&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform),le={alt:"altKey",control:"ctrlKey",meta:"metaKey",shift:"shiftKey"},Oe={add:"+",break:"pause",cmd:"meta",command:"meta",ctl:"control",ctrl:"control",del:"delete",down:"arrowdown",esc:"escape",ins:"insert",left:"arrowleft",mod:ct?"meta":"control",opt:"alt",option:"alt",return:"enter",right:"arrowright",space:" ",spacebar:" ",up:"arrowup",win:"meta",windows:"meta"},ae={backspace:8,tab:9,enter:13,shift:16,control:17,alt:18,pause:19,capslock:20,escape:27," ":32,pageup:33,pagedown:34,end:35,home:36,arrowleft:37,arrowup:38,arrowright:39,arrowdown:40,insert:45,delete:46,meta:91,numlock:144,scrolllock:145,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222};for(K=1;K<20;K++)ae["f"+K]=111+K;var K;function W(n,e,t){e&&!("byKey"in e)&&(t=e,e=null),Array.isArray(n)||(n=[n]);var i=n.map(function(o){return xe(o,e)}),r=function(l){return i.some(function(a){return ke(a,l)})},s=t==null?r:r(t);return s}function ht(n,e){return W(n,e)}function ut(n,e){return W(n,{byKey:!0},e)}function xe(n,e){var t=e&&e.byKey,i={};n=n.replace("++","+add");var r=n.split("+"),s=r.length;for(var o in le)i[le[o]]=!1;var l=!0,a=!1,c=void 0;try{for(var d=r[Symbol.iterator](),h;!(l=(h=d.next()).done);l=!0){var u=h.value,f=u.endsWith("?")&&u.length>1;f&&(u=u.slice(0,-1));var m=de(u),g=le[m];if(u.length>1&&!g&&!Oe[u]&&!ae[m])throw new TypeError('Unknown modifier: "'+u+'"');(s===1||!g)&&(t?i.key=m:i.which=Re(u)),g&&(i[g]=f?null:!0)}}catch(v){a=!0,c=v}finally{try{!l&&d.return&&d.return()}finally{if(a)throw c}}return i}function ke(n,e){for(var t in n){var i=n[t],r=void 0;if(i!=null&&(t==="key"&&e.key!=null?r=e.key.toLowerCase():t==="which"?r=i===91&&e.which===93?91:e.which:r=e[t],!(r==null&&i===!1)&&r!==i))return!1}return!0}function Re(n){n=de(n);var e=ae[n]||n.toUpperCase().charCodeAt(0);return e}function de(n){return n=n.toLowerCase(),n=Oe[n]||n,n}H.default=W;H.isHotkey=W;H.isCodeHotkey=ht;H.isKeyHotkey=ut;H.parseHotkey=xe;H.compareHotkey=ke;H.toKeyCode=Re;H.toKeyName=de});var nt=(n,e=100)=>{let t;return(...r)=>{clearTimeout(t),t=setTimeout(()=>n(...r),e)}},fe=nt;var He=P(Ce()),re=P(Le());function dt(n,e){let t={},i=0,r=0,s;for(i=0,s=n.attributes,r=s.length;i<r;i++){let o=s[i].nodeName||s[i].name,l=s[i].value;!l||(t[o]=l,l!==e.getAttribute(o)&&e.setAttribute(o,l))}for(i=e.attributes.length-1,s=e.attributes;i>=0;i--){let o=s[i].nodeName||s[i].name;!s[i].value||typeof t[o]=="undefined"&&e.removeAttribute(o)}}function R(n,e,t=!0){if(n.nodeType===3&&e.nodeType===3){n.textContent!==e.textContent&&(e.textContent=n.textContent);return}if(n.nodeType!==e.nodeType||n.nodeName!==e.nodeName){e.replaceWith(n.cloneNode(!0));return}if(t||dt(n,e),(!e.childNodes||e.childNodes.length===0)&&n.childNodes&&n.childNodes.length!==0){Array.from(n.childNodes).forEach(i=>{e.appendChild(i.cloneNode(!0))});return}for(Array.from(n.childNodes).forEach((i,r)=>{if(typeof e.childNodes[r]=="undefined"){e.appendChild(i.cloneNode(!0));return}if(i.nodeType!==e.childNodes[r].nodeType)e.childNodes[r].replaceWith(i.cloneNode(!0));else if(i.nodeType===3){e.childNodes[r].textContent!==i.textContent&&(e.childNodes[r].textContent=i.textContent);return}else R(i,e.childNodes[r],!1)});e.lastChild&&e.childNodes.length>n.childNodes.length;)e.removeChild(e.lastChild)}var X=P(ie()),oe=class{constructor(e){this.entryIndex=0;this.entryList=[];this.entryChangeList=[];this.lastContentStr=null;this.id=0;this.counter=-1;this.id=++oe.HistoryInstanceCounter,this.contentContainer=e,this.lastContentDom=document.createElement(e.tagName)}KeyCounter(){return++this.counter}Undo(){if(this.entryList.length===0||this.entryIndex===0)return null;this.entryIndex=this.entryIndex-1;let e="";for(let t=0;t<=this.entryIndex;t++)e=(0,re.default)(e,this.entryList[t].delta);return this.lastContentStr=e,this.lastContentDom.innerHTML=e,R(this.lastContentDom,this.contentContainer),X.default.restore(this.contentContainer,this.entryList[this.entryIndex].selection),{key:this.KeyCounter(),change:this.entryList[this.entryIndex],content:e}}Redo(){if(this.entryIndex+1>=this.entryList.length)return null;this.entryIndex=this.entryIndex+1;let e=this.entryList[this.entryIndex],t="";for(let i=0;i<=this.entryIndex;i++)t=(0,re.default)(t,this.entryList[i].delta);return this.lastContentStr=t,this.lastContentDom.innerHTML=t,R(this.lastContentDom,this.contentContainer),X.default.restore(this.contentContainer,e.selection),{key:this.KeyCounter(),change:e,content:this.contentContainer.innerHTML}}Next(){if(!this.contentContainer||this.lastContentStr===this.contentContainer.innerHTML)return null;this.entryList.length>this.entryIndex+1&&this.entryList.splice(this.entryIndex+1,this.entryList.length-this.entryIndex-1);let e=(0,He.default)(this.lastContentStr||"",this.contentContainer.innerHTML||"");return this.entryList.push({delta:e,selection:X.default.saveSlim(this.contentContainer)}),this.entryIndex=this.entryList.length-1,this.lastContentStr=this.contentContainer.innerHTML,R(this.contentContainer,this.lastContentDom),{key:this.KeyCounter(),change:this.entryList[this.entryList.length-1],content:this.contentContainer.innerHTML}}},se=oe;se.HistoryInstanceCounter=0;var Ie=se;var De=P(Fe());var z=class{constructor(e){this.events={onKeyDown:[],onKeyUp:[],onClick:[],onCommand:[],onFeatureChange:[],onPaste:[],onBlur:[],onBeforeChange:[],onFullscreenChange:[]};this.editor=e}getEvents(){return this.events}trigger(e,t,i){var r;if(typeof this.events[e]!="undefined"){i||(i=[]);for(let s=0,o=this.events[e].length;s<o;s++){if(["registerUI","registerSvg","registerLanguage"].indexOf(e)!==-1){N.presetSvg(this.events[e][s].callback(this.editor));continue}if(e==="registerCss"){N.pluginCSS=Object.assign(N.pluginCSS,this.events[e][s].callback(this.editor));continue}if(e==="registerToolbarItem"){(r=this.editor.toolbar)==null||r.registerPluginItem(this.events[e][s].callback(this.editor));continue}if((e==="onKeyDown"||e==="onKeyUp")&&this.events[e][s].target.length>0){let l=!1;if(this.events[e][s].target.forEach(a=>{(0,De.default)(a,i[1])&&(l=!0)}),!l)continue}else if(this.events[e][s].target&&this.events[e][s].target.length>0&&!this.events[e][s].target.includes(t))continue;e!=="onFeatureChange"&&this.editor.handleFeature(),this.events[e][s].callback.apply(this,i)}}}register(e){e.forEach(t=>{!t.callback||!t.event||(typeof this.events[t.event]=="undefined"&&(this.events[t.event]=[]),this.events[t.event].includes(t)||this.events[t.event].push(t))})}unregister(e){e.forEach(t=>{if(!(!t.callback||!t.event)){for(let i=this.events[t.event].length-1,r=0;i>=r;i--)if(this.events[t.event][i]===t){this.events[t.event].splice(i,1);break}}})}};var _e=class{constructor(){this.path=[];this.pathNode=[];this.node=void 0;this.nodeName="";this.formatEL="";this.color="";this.background="";this.indent="";this.align="";this.bold=!1;this.italic=!1;this.underline=!1;this.strikethrough=!1;this.subscript=!1;this.superscript=!1;this.a={href:"",target:"",node:void 0};this.img={src:"",width:"",height:"",node:void 0};this.video=void 0;this.audio=void 0}};function U(n,e){let t={};return!n||!n.style?t:((n.getAttribute("style")||"").split(";").forEach(r=>{if(!r.trim())return;let s=r.indexOf(":");if(s===-1)return;let o=[r.substring(0,s).trim(),(r.substring(s+1)||"").trim()];t[o[0]]=o[1],o[0]==="background"&&o[1].indexOf("url(")===0&&(t[o[0]]=n.style.background)}),e?t[e]||"":t)}function ft(n,e){let t=new _e;if(!n||!e)return t;let i={},r={};t.node=n.nodeType===Node.TEXT_NODE?n.parentElement:n,t.nodeName=t.node.nodeName;let s=t.node;for(;s&&s!==e;){t.path.push(s.nodeName),t.pathNode.push(s);let a=U(s);Object.keys(a).forEach(c=>{typeof i[c]=="undefined"&&(i[c]=a[c])}),s=s.parentElement}let o=["P","H1","H2","H3","H4","H5","H6","CODE","PRE"],l="";for(let a=0;a<t.path.length;a++)if(l===""&&o.indexOf(t.path[a])!==-1){l=t.path[a];break}if(l==="PRE"&&(l="CODE"),t.formatEL=l,t.bold=t.path.indexOf("STRONG")!==-1,t.italic=t.path.indexOf("EM")!==-1,t.underline=t.path.indexOf("U")!==-1,t.strikethrough=t.path.indexOf("STRIKE")!==-1,t.subscript=t.path.indexOf("SUB")!==-1,t.superscript=t.path.indexOf("SUP")!==-1,t.path.indexOf("A")!==-1){let a=t.pathNode[t.path.indexOf("A")];t.a={href:a.getAttribute("href")||"",target:a.getAttribute("target")||"",node:a}}if(t.path[0]==="IMG"){let a=t.pathNode[0],c=U(a);t.img={src:a.getAttribute("src")||"",width:c.width||"",height:c.height||"",node:a}}if(t.path[0]==="VIDEO"){let a=t.pathNode[0],c=U(a);t.video={controls:a.hasAttribute("controls"),autoplay:a.hasAttribute("autoplay"),width:c.width||"",height:c.height||"",node:a,sources:[]},a.querySelectorAll("source").forEach(d=>{var h;(h=t.video)==null||h.sources.push({src:d.getAttribute("src")||"",type:d.getAttribute("type")||""})})}if(t.path[0]==="AUDIO"){let a=t.pathNode[0],c=U(a);t.video={controls:a.hasAttribute("controls"),autoplay:a.hasAttribute("autoplay"),width:c.width||"",height:c.height||"",node:a,sources:[]},a.querySelectorAll("source").forEach(d=>{var h;(h=t.video)==null||h.sources.push({src:d.getAttribute("src")||"",type:d.getAttribute("type")||""})})}return t.node&&t.node!==e&&(r=U(t.node),t.color=r.color?r.color:"",t.background=r["background-color"]?r["background-color"]:"",t.indent=r["padding-left"]?r["padding-left"]:"",t.align=r["text-align"]?r["text-align"]:""),t}var Pe=ft;function gt(n){return parseInt(n.getAttribute("colspan")||"1",10)}function pt(n){return parseInt(n.getAttribute("rowspan")||"1",10)}function Be(n){let e=0;return Array.from(n.childNodes).forEach(t=>e+=parseInt(t.getAttribute("colspan")||"1",10)),e}function Ke(n){let e=0;return Array.from(n.querySelectorAll("tr")).forEach(t=>{let i=Be(t);i>e&&(e=i)}),e}function mt(n,e=!0,t=!1){let i=Ke(n),r=Array.from(e?n.querySelectorAll("tr"):n.querySelectorAll("tbody tr")),s=[];return r.forEach((o,l)=>{typeof s[l]=="undefined"&&(s[l]=[]);let a=Array.from(o.childNodes),c=0;for(;c<i;)for(let d=0,h=a.length;d<h;d++){for(;typeof s[l][c]!="undefined";)c++;let u=a[d],f=u.colSpan,m=u.rowSpan;for(let g=0;g<m;g++)for(let v=0;v<f;v++)typeof s[l+g]=="undefined"&&(s[l+g]=[]),s[l+g][c+v]=t&&g>0?null:u;c+=f}}),s}var Ue={cellList:mt,col:Ke,rowCol:Be,colSpan:gt,rowSpan:pt};function je(n,e=!1){let r=new DOMParser().parseFromString('<html><head><meta charset="utf-8"></head><body>'+n+"</body></html>","text/html").querySelector("body");return r?e?r.innerHTML:r.childNodes:null}function bt(n,e){Array.from(je(n)).forEach(t=>e.appendChild(t))}function ce(n,e){if(!e||!e.ownerDocument||!n)return 4;var t=e.ownerDocument.createRange();try{t.selectNode(e)}catch(h){t.selectNodeContents(e)}let i=n.compareBoundaryPoints(Range.START_TO_START,t),r=n.compareBoundaryPoints(Range.END_TO_END,t),s=n.compareBoundaryPoints(Range.START_TO_END,t),o=n.compareBoundaryPoints(Range.END_TO_START,t),l=s===-1,a=o===1,c=i!==1,d=r!==-1;return l||a?-1:c&&d?3:!c&&!d?2:!c&&d?0:c&&!d?1:4}function Ve(n,e,t=!0){return t?[0,1,3].indexOf(ce(n,e))!==-1:ce(n,e)===3}function vt(n){let e=[],t=n.startContainer,i=n.endContainer,r=!1;for(let s=0,o=n.commonAncestorContainer.childNodes.length;s<o&&!n.commonAncestorContainer.childNodes.item(s).contains(i);s++)r&&e.push(n.commonAncestorContainer.childNodes.item(s)),n.commonAncestorContainer.childNodes.item(s).contains(t)&&(r=!0);return e}function yt(n){let e=n.commonAncestorContainer,t=n.startContainer,i=n.startOffset,r=n.endContainer,s=n.endOffset;n.startContainer.childNodes.length&&n.startContainer.childNodes[n.startOffset]&&(t=n.startContainer.childNodes[n.startOffset],i=0),r.nodeType!==Node.TEXT_NODE&&(r=n.endContainer.childNodes[n.endOffset],s=0);let o=!1,l=!1,a=[];if(n.collapsed)return a.push({node:t,startOffset:i,endOffset:s,isVoid:O(t),partial:!1,collapsed:!0}),a;let c=function(d){var h,u;if(!l&&!!e.contains(d))if(d===t?o=!0:d===r&&(l=!0),o&&!d.childNodes.length)if(d===t){let f=i!==0;i===0&&r===t&&r.nodeType===Node.TEXT_NODE&&(f=s!==((h=r.textContent)==null?void 0:h.length)),a.push({node:d,startOffset:i,endOffset:r===t?s:(u=t.textContent)==null?void 0:u.length,isVoid:O(d),partial:f,collapsed:n.collapsed})}else d===r&&d!==t&&r.nodeType===Node.TEXT_NODE&&s!==0?a.push({node:d,startOffset:0,endOffset:s,isVoid:O(d),partial:s<r.textContent.length}):d!==r&&a.push({node:d,isVoid:O(d),partial:!1});else d.childNodes.length&&Array.from(d.childNodes).forEach(f=>c(f))};return c(e),a}function Et(n,e){if(e.length===0)return;let t=n.parentNode;!t||(e.forEach(i=>{t.insertBefore(i,n)}),t.removeChild(n))}function qe(n){if(n.length!==0)for(let e=n.length-1;e>=0;e--){let t=n[e];if(!t||t.nodeType!==Node.TEXT_NODE)continue;let i=t.previousSibling;t&&i&&i.nodeType===Node.TEXT_NODE&&(i.textContent+=t.textContent||"",t.parentNode.removeChild(t))}}function Nt(n){if(!n)return;let e=[],t=i=>{for(var r=0;r<i.childNodes.length;r++){var s=i.childNodes[r];s.nodeType!==Node.TEXT_NODE&&s.childNodes?t(s):e.push(s)}};Array.from(n.childNodes).forEach(i=>{i.nodeType===Node.TEXT_NODE?e.push(i):i.childNodes&&t(i)}),qe(e)}function Tt(n,e){var t;!n||((t=n.parentElement)==null||t.insertBefore(e,n),e.appendChild(n))}function he(n,e=void 0){if(!n)return;let t=n.parentNode;if(!(!t||n===e)){for(;n.firstChild;)t.insertBefore(n.firstChild,n);t.removeChild(n)}}function Ct(n,e,t,i){let r=[];if(n.length===0)return;let s=(a,c)=>typeof c=="string"?a.tagName.toLowerCase()===c:c.indexOf(a.tagName.toLowerCase())!==-1,o=(a,c)=>!a||Ve(a,c,!1),l=typeof e=="string"?e:e.join(",");n.forEach(a=>{a.nodeType!==3&&(Array.prototype.forEach.call(a.children,c=>{c.querySelectorAll(l).forEach(d=>{s(d,e)&&o(i,d)&&r.push(d)}),s(c,e)&&o(i,c)&&r.push(c)}),s(a,e)&&o(i,a)&&r.push(a))}),r.forEach(a=>he(a,t))}function Ge(n,e){if(n===e)return!0;let t=Object.keys(n),i=Object.keys(e);if(t.sort(),i.sort(),t.join("_")!==i.join("_"))return!1;let r=Object.values(n),s=Object.values(e);return r.sort(),s.sort(),r.join("_")===s.join("_")}function St(n,e){var r,s,o,l,a,c;if(!n||n.nodeType===3)return;let t=n.querySelectorAll(e),i=t.length;if(!(!t||i===0)){for(let d=i-1;d>=0;d--){let h=t[d],u=h.previousElementSibling;if(!h.hasChildNodes()&&h.textContent===""){(r=h.parentNode)==null||r.removeChild(h);continue}u&&u.nodeName.toLowerCase()===e&&(u.nodeType===3?(u.textContent+=h.textContent||"",(s=h.parentNode)==null||s.removeChild(h)):Ge(j(u),j(h))&&(Xe(u,h),(o=h.parentNode)==null||o.removeChild(h)))}if(t=n.querySelectorAll(e+" > "+e),i=t.length,!(!t||i===0)){for(let d=i-1;d>=0;d--)if(t[d].parentElement&&((l=t[d].parentElement)==null?void 0:l.nodeName.toLowerCase())===e&&Ge(j(t[d].parentElement),j(t[d]))){for(let h=0,u=t[d].childNodes.length;h<u;h++)(a=t[d].parentElement)==null||a.insertBefore(t[d].childNodes[h],t[d]);(c=t[d].parentNode)==null||c.removeChild(t[d])}}}}function j(n,e){let t={};return!n||!n.style?t:((n.getAttribute("style")||"").split(";").forEach(r=>{if(!r.trim())return;let s=r.indexOf(":");if(s===-1)return;let o=[r.substring(0,s).trim(),(r.substring(s+1)||"").trim()];t[o[0]]=o[1],o[0]==="background"&&o[1].indexOf("url(")===0&&(t[o[0]]=n.style.background)}),e?t[e]||"":t)}function Lt(n,e,t){let i="";(n.getAttribute("style")||"").split(";").forEach(s=>{if(!s.trim())return;let o=s.split(":"),l=o[0].trim();l!==e&&(i+=l+":"+o[1].trim()+";")}),t&&(i+=e+":"+t+";"),i?n.setAttribute("style",i):n.removeAttribute("style")}function wt(n,e,t){let i=[];Array.from(n.querySelectorAll("*")).forEach(r=>{if(r.nodeType===3)return;let s="";if((r.getAttribute("style")||"").split(";").forEach(l=>{if(!l.trim())return;let a=l.split(":"),c=a[0].trim(),d=a[1].trim();c!==e&&t!==d&&(s+=c+":"+d+";")}),s===""&&r.nodeName.toLowerCase()==="span"){i.push(r);return}r.setAttribute("style",s)}),i.length!==0&&i.forEach(r=>{he(r)})}function At(n,e){if(n===e||!n.contains(e))return;let t=null;for(let i=e.parentNode;n!=i;i=t){let r=document.createElement(i.nodeName);for(;e.nextSibling;)r.appendChild(e.nextSibling);t=i.parentNode,t.insertBefore(r,i.nextSibling),t.insertBefore(e,r)}}function Mt(n){let e=!0;return n.forEach(t=>{!F(t)&&!ue(t)&&(e=!1)}),e}function Ht(n){let e=!0;return n.forEach(t=>{F(t)||(e=!1)}),e}function It(n){return F(n)||ue(n)}function F(n){return n&&n.nodeType===Node.TEXT_NODE||O(n)}function Ot(n){return n&&n.nodeType===Node.TEXT_NODE}function O(n){return n&&["EMBED","COL","BASE","AREA","IMG","BR","HR","LINK","META","PARAM","SOURCE","TRACK","WBR"].indexOf(n.nodeName)!==-1}function ue(n){return n&&["STRONG","U","EM","I","STRIKE","SUB","SUP","SPAN"].indexOf(n.nodeName)!==-1}function xt(n){let e=n;for(;e&&e.childNodes&&!(!e.childNodes||e.childNodes.length===0);)e=e.childNodes[0];return e}function kt(n){let e=n;for(;e&&e.childNodes&&!(!e.childNodes||e.childNodes.length===0||e.childNodes.length===1&&O(e.childNodes[0]));)e=e.childNodes[e.childNodes.length-1];return e}function Xe(n,e){!n||!e||e.childNodes.length===0||F(n)||Array.from(e.childNodes).forEach(t=>n.appendChild(t))}function Rt(n,e,t){if(!n||!e||!t||t.childNodes.length===0||F(n))return;let i=Q(e);if(i!==-1)for(let r=t.childNodes.length-1;r>=0;r--)t.childNodes[r]&&n.insertBefore(t.childNodes[r],n.childNodes[i])}function Ft(n,e){if(!n||!e)return;let t=Q(e);if(t!==-1)if(t===e.parentNode.childNodes.length-1)for(let i=0,r=n.length;i<r;i++)e.parentNode.appendChild(n[i]);else{let i=e.parentNode.childNodes[t+1];n.forEach(r=>e.parentNode.insertBefore(r,i))}}function Q(n){if(!n.parentNode||!n.parentNode.childNodes)return-1;for(let e=0,t=n.parentNode.childNodes.length;e<t;e++)if(n.parentNode.childNodes[e]===n)return e;return-1}function Dt(n,e){let t=n;if(t!==e){if(t.previousSibling)t=t.previousSibling;else if(t.parentNode&&t.parentNode===e)t=e;else if(t.parentNode)for(t=t.parentNode;t!==e&&!t.previousSibling;)t=t.parentNode}return t}function _t(n,e){let t=[];for(;n&&n!==e;)t.push(n),n=n.parentNode;return t}function Pt(n,e,t){if(!n)return null;if(e){if(e&&V(n,e))return n}else return n.parentNode?n.parentNode:null;let i=n;for(;!V(i,e)&&(!t||i!==t);){if(!i.parentNode)return null;i=i.parentNode}return V(i,e)?i:null}function Bt(n,e){let t=n;if(t!==e){if(t.nextSibling)t=t.nextSibling;else if(t.parentNode&&t.parentNode===e)t=e;else if(t.parentNode)for(t=t.parentNode;t!==e&&!t.nextSibling&&t.parentNode;)t=t.parentNode}return t}function Kt(n){let e=x();return(!e||e.rangeCount===0)&&(n.focus(),e=x()),e||(ze(n),e=x()),e&&e.rangeCount>0?e.getRangeAt(0):!1}function We(){let n=x();return n&&n.rangeCount>0?n.getRangeAt(0):!1}function x(){return window.getSelection()}function Ut(n,e=0){let t=x();t.removeAllRanges();let i=document.createRange();n.nodeType===Node.TEXT_NODE&&(n.textContent||"").length<e+1?(i.setEnd(n,n.textContent.length),i.collapse(!1)):n.nodeType!==Node.TEXT_NODE&&n.childNodes.length<e+1?(i.setEnd(n.parentNode,Math.min(Q(n)+1,n.parentNode.childNodes.length)),i.collapse(!1)):(i.setStart(n,e),i.collapse(!0)),t.addRange(i)}function ze(n,e=-1,t=-1){let i=x();if(!i)return;let r=We();if(i.removeAllRanges(),!(!n&&!r.endContainer)){if(n.parentNode||(n=r.endContainer),e===-1&&n.nodeType===3&&(e=n.textContent.length-1),e===-1&&n.nodeType!==3&&(e=n.childNodes.length-1),n.nodeType===3?i.collapse(n,Math.min(Math.max(e,t,0),n.textContent.length)):V(n,"br")?i.collapse(n):i.collapse(n,Math.min(Math.max(e,t,0),n.childNodes.length)),e===-1&&(i.selectAllChildren(n),i.collapseToEnd()),!i.rangeCount){r=document.createRange(),r.setStart(n,Math.min(Math.max(e,0),n.textContent.length)),r.setEnd(n,Math.min(Math.max(e,t,0),n.textContent.length)),window.getSelection().addRange(r),i=window.getSelection();return}return r=i.getRangeAt(0),e===-1?i.collapseToEnd():(e===0?r.setStart(n,e):r.setStart(n,Math.min(n.childNodes.length?n.childNodes.length:n.textContent.length,e)),t<e&&(t=e),r.setEnd(n,Math.min(n.childNodes.length?n.childNodes.length:n.textContent.length,t))),i}}function jt(n,e){let t=-1;return!n||!n.nodeName?t:typeof e=="string"?n&&n.nodeName&&n.nodeName.toString()===e.toUpperCase()?0:-1:e.indexOf(n.nodeName.toString())}function V(n,e){return typeof e=="string"?n&&n.nodeName&&n.nodeName.toString()===e.toUpperCase():n&&e.indexOf(n.nodeName.toString())!==-1}var Vt={domFragment:je,appendString2Node:bt,rangeCompareNode:ce,rangeContainsNode:Ve,selectDeepNodesInRange:yt,nodeReplaceWith:Et,nodeTextMerge:qe,nodeTextMergeAll:Nt,wrapNode:Tt,unwrapNode:he,unwrapNodes:Ct,mergeTags:St,nodeAttrStyle:j,nodeReplaceAttrStyle:Lt,nodeChildRemoveAttrStyle:wt,nodeIsVoid:O,nodeIsText:Ot,nodeIsTextOrVoid:F,selectNodesBetweenRange:vt,nodeIsTextInlineOrVoid:It,nodesAreTextOrVoid:Ht,getSelection:x,getRange:We,getRangeFocus:Kt,resetSelection:ze,nodeIsInlineFormat:ue,nodesAreTextInlineOrVoid:Mt,nodeNext:Bt,nodeChildFirst:xt,nodeChildLast:kt,nodePrev:Dt,nodeNameCompare:V,nodeNameCompareIndex:jt,nodeParentUntil:_t,nodeParent:Pt,nodeChildInsertBefore:Rt,nodeChildInsertInto:Xe,nodePosition:Q,nodesInsertAfter:Ft,setCaretAt:Ut,nodeBreak:At,table:Ue},q=Vt;var J=class{constructor(e){this.refToolbar=document.createElement("div");this.refShadow=document.createElement("div");this.refTips=document.createElement("div");this.pluginItemList={};this.renderButton=e=>!e.command||!e.svg?"":'<span class="se-button se-ToolbarItem" data-command="'+e.command+'" data-tips="'+this.editor.ln(e.tips||"")+'"><span class="se-icon">'+e.svg+"</span></span>";this.hideDropdownListener=e=>{if(!this.refToolbar){document.removeEventListener("click",this.hideDropdownListener);return}let t=e.target,i=!1;do if(t&&t.classList.contains("se-dropdown-content")){i=!0;break}while(t=t.parentElement);!i&&!this.refToolbar.querySelector(".se-ToolbarItem.is-active .se-dropdown-content .se-button.close-dropdown")&&this.hideDropdown()};this.editor=e,this.prepareUI(),this.registerEvents()}prepareUI(){var e;(e=this.editor.refEditor.querySelector(".SubEditorToolbar"))==null||e.remove(),this.refToolbar=this.editor.refEditor.insertBefore(document.createElement("div"),this.editor.refContent.parentElement),this.refToolbar.classList.add("SubEditorToolbar"),this.refShadow.classList.add("se-Shadow"),this.refToolbar.appendChild(this.refShadow),this.refTips.classList.add("se-tips"),this.refToolbar.appendChild(this.refTips)}registerPluginItem(e){let t=typeof e=="function"?e(this.editor):e;this.pluginItemList=Object.assign(this.pluginItemList,t)}addItem(e){let t;if(typeof e=="string")if(typeof J.presetItemList[e]=="function")t=J.presetItemList[e](this.editor);else if(typeof this.pluginItemList[e]!="undefined")t=this.pluginItemList[e];else if(typeof N.toolbarItemList[e]!="undefined"){let s=N.toolbarItemList[e](this.editor);if(typeof s[e]!="undefined")t=s[e];else return}else return;else typeof e=="function"&&(t=e(this.editor));if(!t||typeof t=="string"||typeof t.command=="undefined")return;let i=document.createElement("div");t.dropdowncontent?t.dropdowncontent&&(i.innerHTML=t.dropdowncontent):i.innerHTML=this.renderButton(t);let r=i.firstChild;this.refToolbar.insertBefore(r,this.refShadow),t.onRender?t.onRender(this.editor,r):r.addEventListener("click",s=>{let o=r.getAttribute("data-command");this.editor.command(o,[])}),i.remove()}initEventTips(e){e.addEventListener("mouseenter",t=>{t.stopPropagation();let i=t.target,r=this.editor.ln(i.getAttribute("data-tips")||"");if(r==="")return;this.refTips.style.display="block",this.refTips.innerHTML=r;let s=this.refToolbar.getBoundingClientRect(),o=i.getBoundingClientRect();this.refTips.style.left=Math.max(0,o.left-s.left+i.clientWidth/2-this.refTips.clientWidth/2)+"px",this.refTips.style.top=o.top-s.top-this.refTips.clientHeight+"px",o.top<o.height&&(this.refTips.style.top=o.height+"px")}),e.addEventListener("mouseleave",t=>{t.stopPropagation(),this.refTips.style.display="none",this.refTips.style.top=""})}initItems(e){e.forEach(t=>this.addItem(t)),this.refToolbar.querySelectorAll("[data-tips]").forEach(t=>this.initEventTips(t))}insertCloseButton(e){this.removeCloseButton(e),this.editor.dom.appendString2Node('<button class="se-button close-dropdown"><span class="se-icon">'+N.svgList.close+"</span></button>",e.querySelector(".se-dropdown-content")),e.querySelector(".se-dropdown-content .se-button.close-dropdown").addEventListener("click",t=>(t.preventDefault(),t.stopPropagation(),this.hideDropdown(),!1))}removeCloseButton(e){let t=e.querySelector(".se-dropdown-content .se-button.close-dropdown");t&&t.remove()}registerEvents(){this.refToolbar.addEventListener("click",e=>{let t=e.target;if(t.classList.contains("se-button")&&t.parentElement.classList.contains("se-dropdown-trigger")){e.preventDefault(),e.stopPropagation();let i=t.parentElement.parentElement,r=i.classList.contains("is-active");return this.hideDropdown(),r?i.classList.remove("is-active"):(i.classList.add("is-active"),this.adjustContentPosition(i.querySelector(".se-dropdown-content")),i.querySelectorAll(".se-dropdown-content [data-tips]").forEach(s=>this.initEventTips(s))),!1}return!0}),typeof this.editor.docListener.click=="undefined"&&(this.editor.docListener.click=[]),this.editor.docListener.click.push(this.hideDropdownListener),document.removeEventListener("click",this.hideDropdownListener),document.addEventListener("click",this.hideDropdownListener),this.editor.event.register([{event:"onFeatureChange",target:[],callback:()=>{this.refToolbar.querySelectorAll("[data-command]").forEach(e=>{var i;let t=e.getAttribute("data-command")||"_";t!=="_"&&(e.classList.remove("is-featured"),e.getAttribute("data-featureformat")?((i=this.editor.feature)==null?void 0:i.formatEL)===e.getAttribute("data-featureformat")&&e.classList.add("is-featured"):typeof this.editor.feature[t]!="undefined"&&this.editor.feature[t]&&e.classList.add("is-featured"))})}}])}adjustContentPosition(e){e.removeAttribute("style"),setTimeout(()=>{let t=e.getBoundingClientRect();if(!t.width)return;let i=t.width/2-18;t.x-i<0&&(i=t.x),e.parentElement.setAttribute("style","transform:translateX(-"+i+"px)")},1)}hideDropdown(){this.refToolbar.querySelectorAll(".se-ToolbarItem.is-active").forEach(e=>e.classList.remove("is-active"))}hasShadow(){return this.refToolbar.classList.contains("EnableShadow")}enableShadow(e){this.disableShadow(),this.refToolbar.classList.add("EnableShadow"),this.refToolbar.querySelectorAll(".se-ToolbarItem").forEach(t=>{let i=t.getAttribute("data-command")||"",r=e.indexOf(i)!==-1;r||t.querySelectorAll("[data-command]").forEach(s=>{!r&&e.indexOf(s.getAttribute("data-command")||"")!==-1&&(r=!0)}),r&&t.classList.add("AboveShadow")})}disableShadow(){this.refToolbar.classList.remove("EnableShadow"),this.refToolbar.querySelectorAll(".AboveShadow").forEach(e=>e.classList.remove("AboveShadow"))}},D=J;D.presetItemList={};var k=P(ie());"use strict";var p=class{constructor(e,t){this.cfgList={};this.cachedList={};this.lang="en";this.autoGrow=!1;this.height=0;this.cacheTextareaStyle="";this.debounceChange=()=>{};this.onChange=()=>{};this.event=new z(this);this.feature=null;this.dom=q;this.docListener={};this.callbackList={};var r;p.initSvg(t.svgList||{}),p.initLang(t.langList||{}),typeof e._SubEditor!="undefined"&&e._SubEditor.destroy(),t.lang&&(this.lang=t.lang),t.ln&&(this.lnFunc=t.ln),t.cfgList&&(this.cfgList=t.cfgList),t.instance&&t.instance(this),this.refEl=e,this.refEl._SubEditor=this,this.refEditor=document.createElement("div"),this.refContent=document.createElement("div"),this.refFooter=document.createElement("div");let i=document.createElement("div");i.classList.add("SubEditorContentContainer"),i.appendChild(this.refContent),this.refEditor.appendChild(i),this.refEditor.appendChild(this.refFooter),e.tagName==="TEXTAREA"?(this.refTextarea=e,(r=this.refTextarea.parentNode)==null||r.insertBefore(this.refEditor,this.refTextarea)):(this.refTextarea=document.createElement("textarea"),e.appendChild(this.refEditor),e.appendChild(this.refTextarea)),this.refEditor.classList.add("SubEditor"),this.refContent.classList.add("SubEditorContent"),this.refFooter.classList.add("SubEditorFooter"),this.cacheTextareaStyle=this.refTextarea.getAttribute("style")||"",this.refEditor.style.width=(t.width?t.width:this.refTextarea.clientWidth)+"px",this.height=t.height?t.height:this.refTextarea.clientHeight,this.refEditor.style.height=this.height+"px",this.refTextarea.style.display="none",this.refTextarea.classList.add("SubEditorTextarea"),t.value&&(this.refTextarea.value=t.value),this.refContent.innerHTML=this.refTextarea.value,this.refContent.setAttribute("contenteditable","true"),this.history=new Ie(this.refContent),this.history.Next(),t.onChange&&(this.onChange=t.onChange),this.toolbar=new D(this),this.refToolbar=this.refEditor.querySelector(".SubEditorToolbar"),this.initPlugins(t.pluginList||[]),this.initEvents(),this.event.trigger("registerCss","",[]),p.initCss(t.css||"",t.skipCss===!0),this.event.trigger("registerSvg","",[]),this.event.trigger("registerLanguage","",[]),this.event.trigger("registerToolbarItem","",[]),this.initToolbarItems(t.toolbarList||[]),typeof t.autoGrow!="undefined"&&this.setAutoGrow(t.autoGrow),this.fixStylePosition(),this.event.trigger("registerUI","",[])}value(){let e=this.refEditor.querySelector(".SubEditorSource");return e?e.value:this.refContent.style.display!=="none"?this.refContent.innerHTML:this.refTextarea.value}ln(e,t=void 0){if(this.lnFunc)return this.lnFunc(e)||e;let i=typeof p.langList[this.lang]!="undefined"&&typeof p.langList[this.lang][e]!="undefined"?p.langList[this.lang][e]:e;return t&&t.length&&t.forEach((r,s)=>{i=i.replace(new RegExp("{%"+(s+1)+"}","g"),r.toString())}),i}registerCallback(e,t){this.callbackList[e]=t}getCallback(e,t=void 0){if(typeof this.callbackList[e]!="undefined")return typeof this.callbackList[e]=="function"?this.callbackList[e].apply(this,t):this.callbackList[e]}static presetToolbarItem(e,t){D.presetItemList[e]=t}static presetPlugin(e,t){p.presetPluginList[e]=t}initPlugins(e){e.forEach(t=>{typeof t=="string"?typeof p.presetPluginList[t]!="undefined"?this.event.register(p.presetPluginList[t]):typeof p.pluginList[t]!="undefined"&&this.event.register(p.pluginList[t]):typeof t=="object"&&t.length&&this.event.register(t)})}handleFeature(){let e=q.getSelection();if(!e||!(e==null?void 0:e.focusNode)||!this.refContent.contains(e.focusNode))return;let t=Pe(e.focusNode,this.refContent);this.feature!==t&&(this.feature=t,this.event.trigger("onFeatureChange",this.feature.nodeName,[this,this.feature]))}initEvents(){this.debounceChange=fe(()=>{this.handleChange(this.history.Next())},300),this.refContent.addEventListener("keyup",e=>{this.event.trigger("onKeyUp",e.target.tagName,[this,e]),this.debounceChange()}),this.refContent.addEventListener("keydown",e=>{this.event.trigger("onKeyDown",e.target.tagName,[this,e])}),this.refContent.addEventListener("click",e=>{this.event.trigger("onClick",e.target.tagName,[this,e])}),this.refContent.addEventListener("mouseup",e=>{this.event.trigger("onMouseUp",e.target.tagName,[this,e])}),this.refContent.addEventListener("blur",e=>{this.event.trigger("onBlur",e.target.tagName,[this,e])}),this.refContent.addEventListener("paste",e=>{this.event.trigger("onPaste",e.target.tagName,[this,e])}),this.docListener.selectionchange=[()=>{let e=q.getSelection().focusNode,t=e===this.refContent;if(!t&&e&&e!==this.refContent)for(;e&&e.parentElement;){if(e.parentNode===this.refContent){t=!0;break}e=e.parentElement}if(!t){this.selection=void 0;return}let i=k.default.saveSlim(this.refContent);JSON.stringify(this.selection)!==JSON.stringify(i)&&(this.selection=i,this.handleFeature(),this.event.trigger("onSelectionChange","",[this,this.selection]))}],document.addEventListener("selectionchange",this.docListener.selectionchange[0])}resetSelection(){this.selection=k.default.saveSlim(this.refContent)}restoreSelection(e=void 0){k.default.restore(this.refContent,e||this.selection)}getSelectionRange(){this.selection||this.resetSelection();let e=q.getSelection(),t=e.getRangeAt(0);return{selection:e,range:t.cloneRange()}}setCache(e,t){this.cachedList[e]=t}getCache(e){return typeof this.cachedList[e]=="undefined"?void 0:this.cachedList[e]}setCfg(e,t){this.cfgList[e]=t}getCfg(e){let t=this.ln(e);return t&&t!==e?t:this.cfgList[e]||""}command(e,t=[]){this.selection||(this.selection=k.default.saveSlim(this.refContent)),k.default.restore(this.refContent,this.selection),this.event.trigger("onCommand",e,[this,e,...t])}disableFooter(){this.refFooter.style.display="none",this.fixStylePosition()}enableFooter(e=15){this.refFooter.style.display="block",this.refFooter.style.height=e+"px",this.fixStylePosition()}setAutoGrow(e){this.autoGrow!==e&&(this.autoGrow=e,e?(this.refEditor.classList.add("AutoGrow"),this.refContent.addEventListener("input",this.growFn),this.refEditor.style.height="auto",this.refContent.parentElement.style.height="auto"):(this.refEditor.classList.remove("AutoGrow"),this.refContent.removeEventListener("input",this.growFn),this.refEditor.style.height=this.height+"px"),this.fixStylePosition())}growFn(e){e.target.parentElement.style.height=e.target.clientHeight+"px"}fixStylePosition(){this.autoGrow||(this.refContent.parentElement.style.height=this.refEditor.clientHeight-this.refToolbar.clientHeight-this.refFooter.clientHeight+"px")}initToolbarItems(e){var t;(t=this.toolbar)==null||t.initItems(e)}destroy(){var e;this.refEl.nodeName==="TEXTAREA"?(this.refEl.setAttribute("style",this.cacheTextareaStyle),(e=this.refEl.parentNode)==null||e.removeChild(this.refEditor),this.refEl.classList.remove("SubEditorTextarea")):(this.refEl.removeChild(this.refEditor),this.refEl.removeChild(this.refTextarea)),this.cachedList=[],this.cfgList=[],this.selection=void 0,this.feature=null,Object.keys(this.docListener).forEach(t=>{this.docListener[t].forEach(i=>{document.removeEventListener(t,i)})}),this.refEl._SubEditor=void 0}static presetLang(e){Object.keys(e).forEach(t=>{p.langList[t]=Object.assign({},p.langList[t]||{},e[t])})}static initLang(e){Object.keys(e).length>0&&p.presetLang(e)}static presetSvg(e){p.svgList=Object.assign(p.svgList,e)}static initSvg(e){p.svgList=Object.assign({},p.svgList||{},e)}static presetCss(e=""){p.presetCssString=e}static lastCss(){return p.lastCssString}static initCss(e="",t=!1){let i="",r=document.querySelector("#SubEditorStyle");if(t&&r)return;Object.keys(p.pluginCSS).forEach(l=>i+=p.pluginCSS[l]);let s=p.cssString+`
`+i+`
`+p.presetCssString+`
`+e;p.lastCssString=s;for(let l=0;l<document.styleSheets.length;l++)if(document.styleSheets[l].title&&document.styleSheets[l].title==="SubEditorStyle"){s!==r.innerHTML&&(r.innerHTML=s);return}let o=window.document.createElement("style");o.title="SubEditorStyle",o.setAttribute("id","SubEditorStyle"),o.innerHTML=s,document.head.appendChild(o)}changeValue(e){this.refEditor&&(this.refContent.innerHTML=e,this.resetSelection(),this.handleFeature(),this.handleChange(this.history.Next()))}triggerChange(){this.refEditor&&(this.handleFeature(),this.handleChange(this.history.Next()))}handleChange(e){this.event.trigger("onBeforeChange","",[this,e]),this.refTextarea.style.display==="none"&&(this.refTextarea.value=this.refContent.innerHTML),e&&this.onChange&&this.onChange(e)}},N=p;N.version="0.6.0",N.cssString="",N.svgList={},N.langList={},N.pluginList={},N.toolbarItemList={},N.presetPluginList={},N.presetCssString="",N.lastCssString="",N.pluginCSS={};"use strict";typeof window!="undefined"&&(window.SubEditor=N);})();
